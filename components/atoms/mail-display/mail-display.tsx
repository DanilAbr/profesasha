import { useState } from 'react';
import useEscKeyListener from '../../../hooks/useEscKeyListener';
import useNonTargetMouseClickListener from "../../../hooks/useNonTargetMouseClickListener";

const EMAIL = 'abramova.alexandra@yahoo.com';

export default function MailDisplay() {
  const [ isOpen, setOpenStatus ] = useState(false);
  const [ isSaved, setSavedStatus ] = useState(false);

  useEscKeyListener(() => setOpenStatus(false));
  useNonTargetMouseClickListener(() => setOpenStatus(false), 'mail-display')

  async function copyText() {
    if (navigator.clipboard) {
      await navigator.clipboard.writeText(`${ EMAIL }`)
      setSavedStatus(true);
    }
  }

  async function clearClipboard() {
    if (navigator.clipboard) {
      await navigator.clipboard.writeText('');
    }
  }

  function openBaloon() {
    setOpenStatus((prev) => !prev);
    setSavedStatus(false);
    clearClipboard();
  }

  return (
    <div className='mail-display'>
      <button
        className='mail-display__popup-button'
        onClick={openBaloon}
        aria-label={ `${ isOpen ? 'закрыть окно' : 'открыть окно' }` }
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="24" viewBox='0 0 32 24'>
          <path d="M15.999.002h10.67c1.789 0 3.252.672 4.332 2.113.61.817.97 1.748.983 2.774.026 2.039.014 4.077.015 6.118 0 2.596.009 5.193 0 7.788-.011 2.288-1.317 4.16-3.477 4.909a5.68 5.68 0 01-1.813.285c-7.136.018-14.272.021-21.408.009-2.75-.01-4.838-1.795-5.25-4.462-.036-.26-.051-.52-.047-.783-.003-4.505-.003-9.01 0-13.516C.01 2.752 1.614.685 3.956.155A6.843 6.843 0 015.438.013c3.52-.015 7.04-.01 10.56-.01zm0 22.497H26.63c2.347 0 3.868-1.528 3.87-3.88V5.39c0-2.37-1.518-3.893-3.888-3.893H5.384c-2.37 0-3.887 1.522-3.89 3.9v13.23c-.004.226.006.45.03.675.212 1.854 1.754 3.196 3.698 3.2 3.6.006 7.187 0 10.78 0z"/><path d="M19.718 13.356c-.113.105-.21.189-.3.278-.902.878-1.802 1.755-2.7 2.633-.54.526-.895.528-1.43.007-.892-.868-1.783-1.737-2.673-2.608-.091-.089-.187-.172-.303-.28-.214.194-.403.366-.59.544l-6.265 5.954c-.11.109-.224.211-.344.308-.38.293-.811.255-1.112-.091-.27-.311-.247-.719.093-1.047.819-.79 1.648-1.57 2.475-2.352 1.463-1.385 2.927-2.77 4.393-4.155.07-.07.142-.151.296-.32-.137-.09-.274-.15-.375-.247a3478.225 3478.225 0 01-6.695-6.533 3.72 3.72 0 01-.319-.334.682.682 0 01.033-.909c.272-.301.657-.383.957-.184.145.102.28.218.405.344l10.37 10.102c.11.107.221.213.356.34.128-.117.242-.214.349-.32L26.738 4.36a3.37 3.37 0 01.29-.262c.356-.275.745-.24 1.047.086.29.313.296.692-.019 1.013-.498.51-1.01 1.003-1.519 1.5-1.79 1.75-3.58 3.496-5.373 5.238-.108.093-.222.18-.341.258l-.066.182c.127.067.277.11.378.204 2.251 2.123 4.5 4.25 6.744 6.38.553.523.451 1.174-.21 1.394-.344.114-.6-.044-.833-.263-.622-.585-1.24-1.174-1.859-1.761-1.65-1.565-3.3-3.132-4.952-4.702-.092-.088-.191-.169-.307-.27z"/>
        </svg>
      </button>
      <div className={ `mail-display__popup ${ isOpen ? 'mail-display__popup--opened' : '' }` }>
        <a
          className='mail-display__value'
          href={ `mailto:${ EMAIL }` }
        >{ EMAIL }</a>
        <button
          className='mail-display__copy-button'
          aria-label='скопировать адрес электронной почты'
          onClick={ copyText }
        >
          { !isSaved &&
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.867 477.867" width='15' height='15'>
              <path d="M341.333 85.333H51.2c-28.277 0-51.2 22.923-51.2 51.2v290.133c0 28.277 22.923 51.2 51.2 51.2h290.133c28.277 0 51.2-22.923 51.2-51.2V136.533c0-28.277-22.923-51.2-51.2-51.2zM358.4 426.667c0 9.426-7.641 17.067-17.067 17.067H51.2c-9.426 0-17.067-7.641-17.067-17.067V136.533c0-9.426 7.641-17.067 17.067-17.067h290.133c9.426 0 17.067 7.641 17.067 17.067v290.134z"/><path d="M426.667 0h-307.2c-28.277 0-51.2 22.923-51.2 51.2 0 9.426 7.641 17.067 17.067 17.067S102.4 60.626 102.4 51.2s7.641-17.067 17.067-17.067h307.2c9.426 0 17.067 7.641 17.067 17.067v307.2c0 9.426-7.641 17.067-17.067 17.067s-17.067 7.641-17.067 17.067 7.641 17.067 17.067 17.067c28.277 0 51.2-22.923 51.2-51.2V51.2c0-28.277-22.923-51.2-51.2-51.2z"/>
            </svg>
          }
          { isSaved &&
            <svg height='15' width='15' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <path d="m256 0c-141.164062 0-256 114.835938-256 256s114.835938 256 256 256 256-114.835938 256-256-114.835938-256-256-256zm0 0" fill="#880006"/>
              <path d="m385.75 201.75-138.667969 138.664062c-4.160156 4.160157-9.621093 6.253907-15.082031 6.253907s-10.921875-2.09375-15.082031-6.253907l-69.332031-69.332031c-8.34375-8.339843-8.34375-21.824219 0-30.164062 8.339843-8.34375 21.820312-8.34375 30.164062 0l54.25 54.25 123.585938-123.582031c8.339843-8.34375 21.820312-8.34375 30.164062 0 8.339844 8.339843 8.339844 21.820312 0 30.164062zm0 0" fill="#fafafa"/>
            </svg>
          }
        </button>
      </div>
    </div>
  )
}
